<!DOCTYPE html>
<meta charset="utf-8">
<style media="screen">

</style>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-queue.v2.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 1440, height = 1000;

var projection = d3.geoAlbers()
    .scale(1000)
    .translate([width / 2, height / 2]);

var path = d3.geoPath()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.queue()
    .defer(d3.json, "ca_county.json") // Load US Counties
    .defer(d3.csv, "2018_data.csv")
    .await(ready); // Run 'ready' when JSONs are loaded

function ready(error, topology, price) {
  if (error) throw error;

  var rateById = {} // Create empty object for holding dataset
  price.forEach(function(d) {
    rateById[d.id] = +d.price; // Create property for each ID, give it value from rate
  });
  console.log(rateById)

  var geojson = topojson.feature(topology, {
        type: "GeometryCollection",
        geometries: topology.objects.ca_county.geometries
    });

    // var color = d3.scaleThreshold()
    //   .domain([0, 250000, 500000, 750000, 1000000, 1250000, 1500000])
    //   .range(d3.schemeBlues[7]);

    var domain = [0, 250000, 500000, 750000, 1000000, 1250000, 1500000]
    var color = d3.scaleThreshold()
        .domain(domain)
        .range(["#90A4AE", "#78909C", "#607D8B", "#546E7A", "#455A64", "#37474F"]);

  svg.append("g")
      .attr("class", "counties")
    .selectAll("path")
      .data(geojson.features) // Bind TopoJSON data elements
    .enter().append("path")
      .attr("d", path)
      .style("fill", function(d) {
		    return color(d.price = rateById[d.properties.NAME]); // get rate value for property matching data ID
		    // pass rate value to color function, return color based on domain and range
	    })
      .style("stroke", "white")
      .style("stroke-width", ".1px");
}
</script>
